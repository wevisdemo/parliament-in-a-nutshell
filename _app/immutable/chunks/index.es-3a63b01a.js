import{a as L,m as N,g as W,r as G,c as V,w as z,_ as H,i as J,k as P,e as Q,f as w,h as R,j as U,l as X,d as Y,o as Z,p as $}from"./tslib.es6-58dba148.js";import{r as q}from"./resolve-elements.es-2caf236e.js";var ee=function(){};function B(t,e,a,s){var n;return L(e)?e:e.startsWith("-")||e.startsWith("+")?Math.max(0,t+parseFloat(e)):e==="<"?a:(n=s.get(e))!==null&&n!==void 0?n:t}function te(t,e,a){for(let s=0;s<t.length;s++){const n=t[s];n.at>e&&n.at<a&&(G(t,n),s--)}}function ne(t,e,a,s,n,f){te(t,n,f);for(let u=0;u<e.length;u++)t.push({value:e[u],at:N(n,f,s[u]),easing:W(a,u)})}function ae(t,e){return t.at===e.at?t.value===null?1:-1:t.at-e.at}function fe(t,e={}){var a;const s=se(t,e),n=s.map(f=>V(...f)).filter(Boolean);return z(n,e,(a=s[0])===null||a===void 0?void 0:a[3].duration)}function se(t,e={}){var{defaultOptions:a={}}=e,s=H(e,["defaultOptions"]);const n=[],f=new Map,u={},O=new Map;let D=0,m=0,k=0;for(let c=0;c<t.length;c++){const r=t[c];if(J(r)){O.set(r,m);continue}else if(!Array.isArray(r)){O.set(r.name,B(m,r.at,D,O));continue}const[S,g,o={}]=r;o.at!==void 0&&(m=B(m,o.at,D,O));let i=0;const h=q(S,u),d=h.length;for(let p=0;p<d;p++){const M=h[p],b=ie(M,f);for(const E in g){const C=oe(E,b);let l=P(g[E]);const A=Q(o,E);let{duration:j=a.duration||w.duration,easing:T=a.easing||w.easing}=A;if(R(T)){const x=U(E);ee(l.length===2||!x);const y=T.createAnimation(l,()=>"0",x);T=y.easing,y.keyframes!==void 0&&(l=y.keyframes),y.duration!==void 0&&(j=y.duration)}const F=X(o.delay,p,d)||0,_=m+F,I=_+j;let{offset:v=Y(l.length)}=A;v.length===1&&v[0]===0&&(v[1]=1);const K=length-l.length;K>0&&Z(v,K),l.length===1&&l.unshift(null),ne(C,l,T,v,_,I),i=Math.max(F+j,i),k=Math.max(I,k)}}D=m,m+=i}return f.forEach((c,r)=>{for(const S in c){const g=c[S];g.sort(ae);const o=[],i=[],h=[];for(let d=0;d<g.length;d++){const{at:p,value:M,easing:b}=g[d];o.push(M),i.push($(0,k,p)),h.push(b||w.easing)}i[0]!==0&&(i.unshift(0),o.unshift(o[0]),h.unshift("linear")),i[i.length-1]!==1&&(i.push(1),o.push(null)),n.push([r,S,o,Object.assign(Object.assign(Object.assign({},a),{duration:k,easing:h,offset:i}),s)])}}),n}function ie(t,e){return!e.has(t)&&e.set(t,{}),e.get(t)}function oe(t,e){return e[t]||(e[t]=[]),e[t]}export{fe as t};
